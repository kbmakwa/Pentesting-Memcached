

<p align="center">
   <img src="https://github.com/kbmakwa/Pentesting-Memcache/assets/168517452/1699c9d5-6942-452c-ac49-2a0b7b729b52" alt="MEMCACHED"/>
</p>

<h1 align="center">Pentesting Memcache On Port 11211 </h1>


**Memcached** is an open-source, high-performance **in-memory key-value store**. It acts like a temporary data storage service which stores data in `<key>` : `<value>` format. By caching chunks of data, Memcached improves the overall performance of websites.

**Here's how it works:**

* Data is stored in key-value pairs. The `<key>` is a unique identifier for the data, and the `<value>` is the actual data itself.
* Frequently accessed data is stored in RAM (computer's fast memory) for quicker retrieval.
* When a user requests information, the application checks the cache first. If the data is found, it's retrieved from RAM, which is much faster than accessing the database.
* This reduces the load on the database and speeds up your website.

**Example Scenarios where Memcached might be used:**

* **Static Data:**  Large chunks of static data that need to be displayed as-is, like a list of countries for a registration form or bank IFSC codes.
* **Search Functionality:**  Caching the most searched items for quicker retrieval when a user performs a search.

**Popular Uses:**

Several well-known web applications like YouTube, Wikipedia, and Twitter leverage Memcached for performance boosting.

**For further details:** You can refer to the official Memcached website [memcached.org]. (Note: I can't include links directly, but you can search for "memcached.org").

**Port 11211:**

  Memcached communicates over TCP/UDP port 11211 by default.
  This port allows clients to connect to the Memcached server and interact with it.

**Finding Memcached in the wild**
  + **SHODAN :** port:11211 "STAT pid"
  + **ZOOMEYE :** port:11211
  + **FOFA :** port="11211"

<h1> Memcached Enumeration </h4>


<h1 align="center">Manually </h4>


1. **With nc (netcat)**

   ```
   echo "version" | nc -vn -w 1 <IP> 11211      #Get version
   echo "stats" | nc -vn -w 1 <IP> 11211        #Get status
   echo "stats slabs" | nc -vn -w 1 <IP> 11211  #Get slabs
   echo "stats items" | nc -vn -w 1 <IP> 11211  #Get items of slabs with info
   echo "stats cachedump <number> 0" | nc -vn -w 1 <IP> 11211  #Get key names (the 0 is for unlimited output size)
   echo "get <item_name>" | nc -vn -w 1 <IP> 11211  #Get saved info
   ```
2. **With libmemcached-tools**
   
   ```
   sudo apt install libmemcached-tools
   memcstat --servers=<ip> #Get stats
   memcdump --servers=<ip> #Get all items
   memccat  --servers=<ip> <item1> <item2> <item3> #Get info inside the item(s)
   ```
3. **With Telnet**
   
   ```
   telnet <ip> 11211
   ```
   Once connected to the terminal Type ```stats items``` to get the iterms
   
   What exactly is an item? An item can be thought of as slabs of the actual key:value data. The stats items command simply details the statistics of all the items or slabs of data created by Memcache.

   Use ```stats cachedump <item: id> <number of keys you want to query>  ``` to query the number of keys stored in the slab (item).

   **example :** ```stats cachedump 68 0```
   
   Now, letâ€™s retrieve the data using the key that we have got. To do that we simply need to fire the command ```get <key_name>```

<h1 align="center">Automatic :trollface: </h4>
   

1. **With Metasploit**
   
   ```
   msf > use auxiliary/gather/memcached_extractor      #Extracts saved data
   msf > use auxiliary/scanner/memcached/memcached_amp #Check is UDP DDoS amplification attack is possible
   ```
   
2. **With Nmap**

   ```
   nmap -n -sV --script memcached-info -p 11211 <IP>   #Just gather info
   ```

3. **With php**

   ```
   php -r '$c = new Memcached(); $c->addServer("<ip>", 11211); var_dump( $c->getAllKeys() );'
   ```

**Amplification Attacks**:
   - **Memcached** has been exploited in amplification attacks, where attackers use it to generate massive traffic.
   - In these attacks, an IP-spoofing capable attacker sends forged requests to a vulnerable **UDP Memcached** server.
   - The server, unaware that the request is forged, prepares large responses.
   - Thousands of these responses overwhelm the target host, often saturating its network resources.
   - The large response packets contribute to the effectiveness of amplification attacks.

<h1 >Securing Memcached Servers ðŸ”’ </h4>

* **Reduce Exposure:** This is the most crucial step. By default, Memcached listens on port 11211, which can be a target for attackers. Here's how to minimize exposure:

    * **Bind to Local Interface:**  Configure Memcached to listen only on the local interface (127.0.0.1) if the server itself and the applications using Memcached reside on the same machine. This restricts access from external networks. 
    * **Limit Access with Firewall:**  If Memcached needs to be accessed from other servers on a private network, use firewall rules to restrict access to only trusted IP addresses. 
    * **Disable UDP (if not used):** Memcached supports TCP and UDP connections. If your application only uses TCP, disable UDP support in the configuration file. This eliminates the possibility of UDP-based amplification attacks.

**Example with iptables firewall (assuming Ubuntu/Debian):**

```bash
iptables -A INPUT -p tcp --dport 11211 -s <trusted_ip_address> -j ACCEPT
iptables -A INPUT -p tcp --dport 11211 -j DROP
```

Replace `<trusted_ip_address>` with the actual IP address of the authorized server.

**Advanced Security Measures:**

* **Change Default Port:** Consider changing the default port (11211) to a less common port number. This makes it harder for automated scanners to identify Memcached servers. However, ensure firewalls are configured accordingly for the new port.
* **Authentication (SASL):** Implement authentication using SASL (Simple Authentication and Security Layer) to restrict access only to authorized users with passwords. Refer to your Memcached documentation for specific configuration steps.
* **Keep Software Updated:** Regularly update Memcached software to benefit from security patches that address vulnerabilities.

**Disabling Memcached (if not needed):**

If Memcached is not required for your application's functionality, it's best to disable it completely. This eliminates any potential security risks associated with an exposed service. The specific steps to disable Memcached depend on your operating system and package manager. Here are general guidelines:

* **Systemd (common on Ubuntu/Debian):**

```bash
systemctl stop memcached
systemctl disable memcached
```

* **SysV init (older systems):**

```bash
service memcached stop
update-rc.d memcached disable
```
<h1>References: </h4>

   + https://lzone.de/cheat-sheet/memcached
   + https://book.hacktricks.xyz/network-services-pentesting/11211-memcache
   + https://niiconsulting.com/checkmate/2013/05/memcache-exploit/
   + http://en.wikipedia.org/wiki/Memcached


